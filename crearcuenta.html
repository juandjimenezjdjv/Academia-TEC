<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AcademiaTEC</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/botones.css">
    <link rel="stylesheet" href="css/popup.css">
    <link rel="stylesheet" href="css/formularios.css">
    <link rel="stylesheet" href="css/sesiones.css"> 
    <link rel="stylesheet" href="css/historial.css"> 
    <link rel="icon" href="img/ATicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
  </head>

  <body>
    <div class="top">
      <ul>
        <li>
          <a href="index.html">
            <img src="img/logo-home.png" alt="Inicio" class="logo">
          </a>
        </li>
        <li><a href="index.html" class="btn-top">Página de inicio</a></li>
        <li><a href="tutorias.html" class="btn-top">Tutorías</a></li>
        <li><a href="contactenos.html" class="btn-top">Contáctenos</a></li>
        <li><a href="nueva_tutoria.html" class="btn-top">Nueva tutoría</a></li>
        <li>
          <a href="crearcuenta.html" id="openPopup">
            <img src="img/register.png" alt="Registro" class="logo">
          </a>
        </li>
        <li>
          <a href="mis_tutorias.html">
            <img src="img/mis-tutorias.png" alt="Mis tutorías" class="logo">
          </a>
        </li>
      </ul>
    </div>
          
    <div class="popup-wrapper" id="popupWrapper" style="display: none;">
      <div id="popup" class="popup">
        <div class="popup-content">
          <span class="close" id="closePopup">&times;</span>
          <div class="centrado">
            <h2><strong>¡Bienvenido!</strong></h2>
            <a class="custom-btn" href="perfil_config.html" id="vperfil">Ver perfil</a><br>
            <a class="custom-btn" href="iniciosesion.html" id="inisesion">Iniciar sesión</a><br>
            <a class="custom-btn-white" href="crearcuenta.html" id="crearsesion">Crear cuenta</a></br>
            <a class="custom-btn" href="index.html" id="Scerrarsesion">Cerrar sesion</a>
          </div>
        </div>
      </div>
    </div>

    <div class="container" style="width: 940px;">
      <div class="middle" style="width: 1000px">
        <div class="box-sesion">
          <div class="left-sesion">
            <h2><strong>Crear cuenta</strong></h2>
            <p>Ya tienes cuenta,</p><p><a href="iniciosesion.html" class="btn-sesiones">Inicia sesión</a></p>
            
            <div class="container-forms">
              <div class="form-section-15">
                  <div class="form-row-inline">
                      <div class="form-field-f15">
                        <label for="nombrecrear">Nombre:</label>
                        <input type="text" id="nombrecrear" name="nombrecrear">
                      </div>
                      <div class="form-field-f15">
                        <label for="Apellidocrear">Apellido:</label>
                        <input type="text" id="Apellidocrear" name="Apellidocrear">
                      </div>
                  </div>
              </div>
            </div>
            <div class="container-forms">
              <div class="form-section-15">
                  <div class="form-row-inline">
                      <div class="form-field-f15">
                        <label for="emailcrear">Correo:</label>
                        <input type="email" id="emailcrear" name="emailcrear" required>
                      </div>
                      <div class="form-field-f15">
                        <label for="Apellido">Contraseña:</label>
                        <input type="password" id="Apellido" name="Apellido" pattern="[A-Za-z0-9]{8,12}" title="La contraseña debe tener entre 8 y 12 caracteres y solo puede contener letras y números" required>
                      </div>
                  </div>
              </div>
            </div>
            <div class="container-forms">
              <div class="form-section-15">

                <div class="form-row-inline">
                  <div class="form-field-f15">
                      
                      <label for="ninteress">Interés:</label>
                      <div class="day-checkbox-container">
                        <select id="interess" name="categoriat">
                          <option value=""></option>
                        </select>
                      </div>
                  </div>
                  <div class="form-field-f15">                    
                    <label for="nombre">¿Eres profesor?</label>
                    <div class="checkbox-container">
                      <input type="checkbox" name="checkbox_nombre" class="custom-checkbox">
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <a  class="custom-btn-p" id="crearsesiones">Crear cuenta</a>


          </div>
          <div class="right-sesion">
            <div class="right-sesion-oculto">
              <div class="container-forms">
                <div class="form-section-30-p">
                    <div class="form-row-inline  content-oculto">
                      <div class="form-field-f30">
                        <label for="descripcion">Descripción del profesor</label>
                        <input type="text" id="descripcion" name="descripcion">
                      </div>
                    </div>
                </div>
              </div>
              <div class="container-forms">
                <div class="form-section-30-p">
                    <div class="form-row-inline content-oculto">
                      <div class="form-field-f30">
                        <label for="especialidad">Especialidad</label>
                        <input type="text" id="especialidad" name="especialidad"><br>
                      </div>
                    </div>
                </div>
              </div>



              <div class="container-forms">
                <div class="form-section-30-p">
                  <div class="form-field-f30">
                    <label for="Organizar"><strong>Oganice su horario</strong></label><br/>
                    <label for="horario">Horario:</label><br/>
                  </div>
                  <div class="form-row-inline-form content-oculto">
                    <div class="day-checkbox-container">
                      <label for="lunes">Lunes</label>
                      <input type="checkbox" id="lunes" name="checkbox_nombre" class="custom-checkbox">
                    </div>
                    <div class="day-checkbox-container">
                      <label for="martes">Martes</label>
                      <input type="checkbox" id="martes" name="checkbox_nombre" class="custom-checkbox">
                    </div>
                    <div class="day-checkbox-container">
                      <label for="miercoles">Miércoles</label>
                      <input type="checkbox" id="miercoles" name="checkbox_nombre" class="custom-checkbox">
                    </div>
                  </div>                    
                  <div class="form-row-inline-form content-oculto">                      
                    <div class="day-checkbox-container">
                      <label for="jueves">Jueves</label>
                      <input type="checkbox" id="jueves" name="checkbox_nombre" class="custom-checkbox">
                    </div>
                    <div class="day-checkbox-container">
                      <label for="viernes">Viernes</label>
                      <input type="checkbox" id="viernes" name="checkbox_nombre" class="custom-checkbox">
                    </div>
                    <div class="day-checkbox-container">
                      <label for="sabado">Sábado</label>
                      <input type="checkbox" id="sabado" name="checkbox_nombre" class="custom-checkbox">
                    </div>
                  </div>
                </div>
              </div>


              <div class="container-forms">
                <div class="form-section-30-p">
                  <div class="form-row-inline content-oculto">
                    <div class="day-checkbox-container">
                      <label for="hora_inicio">Hora de inicio:</label>
                      <select id="hora_inicio" name="hora_inicio">
                        <option value="06:00">6:00 AM</option>
                        <option value="07:00">7:00 AM</option>
                        <option value="08:00">8:00 AM</option>
                        <option value="09:00">9:00 AM</option>
                        <option value="10:00">10:00 AM</option>
                        <option value="11:00">11:00 AM</option>
                        <option value="12:00">12:00 AM</option>
                        <option value="13:00">01:00 PM</option>
                        <option value="14:00">02:00 PM</option>
                        <option value="15:00">03:00 PM</option>
                        <option value="16:00">04:00 PM</option>
                        <option value="17:00">05:00 PM</option>
                        <option value="18:00">06:00 PM</option>
                        <option value="19:00">07:00 PM</option>
                      </select>
                    </div>
                    <div class="day-checkbox-container">
                      <label for="hora_fin">Hora de fin:</label>
                      <select id="hora_fin" name="hora_fin">
                        <option value="06:00">6:00 AM</option>
                        <option value="07:00">7:00 AM</option>
                        <option value="08:00">8:00 AM</option>
                        <option value="09:00">9:00 AM</option>
                        <option value="10:00">10:00 AM</option>
                        <option value="11:00">11:00 AM</option>
                        <option value="12:00">12:00 AM</option>
                        <option value="13:00">01:00 PM</option>
                        <option value="14:00">02:00 PM</option>
                        <option value="15:00">03:00 PM</option>
                        <option value="16:00">04:00 PM</option>
                        <option value="17:00">05:00 PM</option>
                        <option value="18:00">06:00 PM</option>
                        <option value="19:00">07:00 PM</option>
                        <option value="20:00">08:00 PM</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

      <!-- Esto esta bien, asi deben ser todos los bottom -->
    <div style="text-align: center;" class="bottom">
      <img  src="img/logo.png" alt="logo photo">
      <p class="text-bottom">Únete a nuestra comunidad de aprendizaje en línea.</p>
      <hr style="border-top: 0.1px  white; width: 100%;">
      <p class="copyr">Copyrigth © 2024 AcademiaTEC</p>
    </div> 
      
    <script src="js/script.js"></script>
    <script>
      function toggleRightSesion() {
          var checkbox = document.querySelector('.custom-checkbox');
          var rightSesion = document.querySelector('.right-sesion-oculto');
          rightSesion.style.display = checkbox.checked ? 'block' : 'none';
        }
        document.querySelector('.custom-checkbox').addEventListener('change', toggleRightSesion);
        toggleRightSesion();

      function validarHoras() {
      var horaInicio = document.getElementById('hora_inicio').value;
      var horaFin = document.getElementById('hora_fin').value;
      if (horaInicio >= horaFin) {
        alert('La hora de inicio debe ser menor que la hora de fin');
        document.getElementById('hora_fin').value = '20:00';
      }
      }
      document.getElementById('hora_inicio').addEventListener('change', validarHoras);
      document.getElementById('hora_fin').addEventListener('change', validarHoras);

      document.addEventListener('DOMContentLoaded', async function() { 
      const crearSesionBtn = document.getElementById('crearsesiones');

      crearSesionBtn.addEventListener('click', async function(event) {
        event.preventDefault();
        const nombre = document.getElementById("nombrecrear").value;
        const apellido = document.getElementById("Apellidocrear").value;
        const correo = document.getElementById("emailcrear").value;
        const contrasena = document.getElementById("Apellido").value;
        // Validación de la contraseña
        const regexContrasena = /^[A-Za-z0-9]{8,12}$/;
        if (!regexContrasena.test(contrasena)) {
          alert('La contraseña debe tener entre 8 y 12 caracteres y solo puede contener letras y números.');
          return;
        }

        // Validación del correo electrónico
        const regexCorreo = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!regexCorreo.test(correo)) {
          alert('Por favor ingrese un correo electrónico válido.');
          return;
        }

        const interes = document.getElementById("interess").value;
        const esProfesor = document.querySelector("input[name='checkbox_nombre']").checked;
        const rol = esProfesor ? 1 : 2;
        const user = {
          nombre: nombre,
          apellido: apellido,
          correo: correo,
          contrasena: contrasena,
          interes: interes,
          rol: rol,
          
        };
        let data;
        if (esProfesor) {
          user.profesorDetalles = {
            descripcion: document.getElementById("descripcion").value,
            especialidad: document.getElementById("especialidad").value,
            horario: {
              lunes: document.getElementById("lunes").checked,
              martes: document.getElementById("martes").checked,
              miercoles: document.getElementById("miercoles").checked,
              jueves: document.getElementById("jueves").checked,
              viernes: document.getElementById("viernes").checked,
              sabado: document.getElementById("sabado").checked,
              horaInicio: document.getElementById("hora_inicio").value,
              horaFin: document.getElementById("hora_fin").value
            }
          };
          data = await crearProfe(user);
        } else {
          data = await crearCuenta(user);
        }

        if (data.message === "Cuenta creada exitosamente") {
          sessionStorage.setItem('usuario', JSON.stringify(data.payload));
          setTimeout(() => {
            window.location.href = "index.html";
          }, 100);
        } else {
          console.log("Account creation failed");
        }
      });
    });

    async function crearCuenta(user) {
      const response = await fetch("http://localhost:1434/crearUsuario", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(user),
      });
      const data = await response.json();
      data.message = "Cuenta creada exitosamente";
      return data;
    }

    async function crearProfe(user) {
      const response = await fetch("http://localhost:1434/crearProfe", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(user),
      });
      const data = await response.json();
      data.message = "Cuenta creada exitosamente";
      return data;
    }

    async function loadCategorias() {
      try {
        const response = await fetch('http://localhost:1434/categorias'); 
        const categorias = await response.json();
        const select = document.getElementById('interess');

        categorias.forEach(categoria => {
          const option = document.createElement('option');
          option.value = categoria.intereses;
          option.textContent = categoria.nombreCategoria;
          select.appendChild(option);
        });
      } catch (error) {
        console.error('Error al cargar las categorías:', error);
      }
    }
    document.addEventListener('DOMContentLoaded', loadCategorias);
    </script>
  </body>
</html>